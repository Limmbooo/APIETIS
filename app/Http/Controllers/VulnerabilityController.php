<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Illuminate\Support\Facades\DB;

class VulnerabilityController extends Controller
{
    public function sqlInjection(Request $request)
    {
        $userId = $request->input('id');

        // Query raw yang sangat rentan
        $user = DB::select("SELECT * FROM users WHERE id = $userId");

        if ($user) {
            return response()->json($user);
        }

        return response()->json(['error' => 'User not found'], 404);
    }


    public function xss(Request $request)
    {
        $input = $request->input('data');

        // Data langsung dikembalikan tanpa sanitasi
        return response()->json(['message' => "You entered: $input"]);
    }

    public function noAuth()
    {
        // Data sensitif diberikan tanpa autentikasi
        return response()->json(['secret' => 'This is sensitive data.']);
    }

    public function directoryTraversal(Request $request)
    {
        $filename = $request->input('file');

        // Akses langsung ke file tanpa validasi path
        $path = storage_path("app/$filename");

        if (file_exists($path)) {
            return response()->file($path);
        }

        return response()->json(['error' => 'File not found'], 404);
    }

    public function insecureFileUpload(Request $request)
    {
        if ($request->hasFile('file')) {
            // Simpan file tanpa validasi jenis file
            $path = $request->file('file')->store('uploads');

            return response()->json(['path' => $path], 201);
        }

        return response()->json(['error' => 'No file uploaded'], 400);
    }
}
